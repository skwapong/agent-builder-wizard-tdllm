<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Agent Builder Wizard - PM Agent Squad Master</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {}
            },
            plugins: []
        }
    </script>
    <link rel="stylesheet" href="td-theme.css">
    <style>
        /* Prose-like styling for chat messages */
        .prose-chat h1, .prose-chat h2, .prose-chat h3 { font-weight: 600; margin-top: 0.5em; margin-bottom: 0.25em; }
        .prose-chat h1 { font-size: 1.25em; }
        .prose-chat h2 { font-size: 1.1em; }
        .prose-chat h3 { font-size: 1em; }
        .prose-chat p { margin-bottom: 0.5em; }
        .prose-chat ul, .prose-chat ol { margin-left: 1.25em; margin-bottom: 0.5em; }
        .prose-chat li { margin-bottom: 0.25em; }
        .prose-chat ul { list-style-type: disc; }
        .prose-chat ol { list-style-type: decimal; }
        .prose-chat strong { font-weight: 600; color: #1e1b4b; }
        .prose-chat code { background: #e0e7ff; padding: 0.1em 0.3em; border-radius: 3px; font-size: 0.9em; }
        .prose-chat pre { background: #1e1b4b; color: #e0e7ff; padding: 0.75em; border-radius: 6px; overflow-x: auto; margin: 0.5em 0; }
        .prose-chat pre code { background: none; padding: 0; }
        .prose-chat blockquote { border-left: 3px solid #6366f1; padding-left: 0.75em; color: #4b5563; font-style: italic; margin: 0.5em 0; }
        .prose-chat a { color: #4f46e5; text-decoration: underline; }
        .prose-chat hr { border: none; border-top: 1px solid #e5e7eb; margin: 0.75em 0; }
    </style>
    <!-- Password Protection Styles -->
    <style>
        #passwordOverlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }
        #passwordOverlay.hidden {
            display: none;
        }
        .password-card {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 100%;
            max-width: 400px;
            margin: 20px;
        }
        .password-card h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            text-align: center;
            margin-bottom: 8px;
        }
        .password-card p {
            color: #6b7280;
            text-align: center;
            margin-bottom: 24px;
            font-size: 0.875rem;
        }
        .password-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            outline: none;
            box-sizing: border-box;
        }
        .password-input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        .password-input.error {
            border-color: #ef4444;
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        .password-btn {
            width: 100%;
            padding: 12px 24px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 16px;
        }
        .password-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }
        .password-btn:active {
            transform: translateY(0);
        }
        .password-error {
            color: #ef4444;
            font-size: 0.875rem;
            text-align: center;
            margin-top: 12px;
            display: none;
        }
        .password-error.visible {
            display: block;
        }
        /* Hide main content until authenticated */
        body.locked > *:not(#passwordOverlay) {
            display: none !important;
        }
    </style>
    <!-- Password Protection -->
    <script>
    (function() {
        const PASS_KEY = 'td_agent_builder_auth';
        const CORRECT_PASSWORD = '!PMAgentSquad!';

        // Check if already authenticated
        if (sessionStorage.getItem(PASS_KEY) === 'authenticated') {
            return; // Already authenticated, let page load normally
        }

        // Lock the body until authenticated
        document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('locked');
        });

        // Create and inject password overlay
        document.addEventListener('DOMContentLoaded', function() {
            const overlay = document.createElement('div');
            overlay.id = 'passwordOverlay';
            overlay.innerHTML = `
                <div class="password-card">
                    <h2>TD Agent Builder</h2>
                    <p>Enter password to continue</p>
                    <input type="password" id="passwordInput" class="password-input" placeholder="Password" autocomplete="off">
                    <button id="passwordSubmit" class="password-btn">Login</button>
                    <p id="passwordError" class="password-error">Incorrect password. Please try again.</p>
                </div>
            `;
            document.body.appendChild(overlay);

            const input = document.getElementById('passwordInput');
            const btn = document.getElementById('passwordSubmit');
            const error = document.getElementById('passwordError');

            function attemptLogin() {
                const password = input.value;
                if (password === CORRECT_PASSWORD) {
                    sessionStorage.setItem(PASS_KEY, 'authenticated');
                    overlay.classList.add('hidden');
                    document.body.classList.remove('locked');
                } else {
                    input.classList.add('error');
                    error.classList.add('visible');
                    input.value = '';
                    setTimeout(() => {
                        input.classList.remove('error');
                    }, 500);
                }
            }

            btn.addEventListener('click', attemptLogin);
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    attemptLogin();
                }
            });

            // Focus the input
            input.focus();
        });
    })();
    </script>
    <style>
        /* Make all text selectable for easy copying */
        * {
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }

        /* Keep buttons non-selectable for better UX */
        button, .drag-handle {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .step-content {
            display: none;
        }
        .step-content.active {
            display: block;
        }
        .step-indicator {
            opacity: 0.5;
        }
        .step-indicator.active {
            opacity: 1;
        }
        .step-indicator.completed {
            opacity: 1;
        }
        .kb-editor {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        .ai-message {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .typing-indicator {
            display: inline-flex;
            gap: 4px;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #6366f1;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            30% {
                opacity: 1;
                transform: scale(1);
            }
        }
        /* Drag and Drop Styles */
        .draggable-section {
            cursor: grab;
        }
        .draggable-section:active {
            cursor: grabbing;
        }
        .draggable-section.dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }
        .draggable-section.drag-over {
            border: 2px dashed #6366f1;
            background-color: #f0f0ff;
        }
        .drag-handle {
            cursor: move;
            transition: all 0.2s;
        }
        .drag-handle:hover {
            transform: scale(1.1);
        }

        /* Toast Notification Styles */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }
        .toast {
            pointer-events: auto;
            background: white;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            max-width: 400px;
            animation: toastSlideIn 0.3s ease-out;
            border-left: 4px solid;
        }
        .toast.toast-success {
            border-left-color: #10b981;
        }
        .toast.toast-error {
            border-left-color: #ef4444;
        }
        .toast.toast-info {
            border-left-color: #3b82f6;
        }
        .toast.toast-warning {
            border-left-color: #f59e0b;
        }
        .toast.toast-hiding {
            animation: toastSlideOut 0.3s ease-in forwards;
        }
        @keyframes toastSlideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes toastSlideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* Progress Bar Styles */
        .progress-bar-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: rgba(209, 213, 219, 0.3);
            z-index: 9998;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }

        /* Markdown Preview Styles */
        .markdown-preview {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
        }
        .markdown-preview h1 {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 0;
            margin-bottom: 0.5em;
            color: #111827;
        }
        .markdown-preview h2 {
            font-size: 1.25em;
            font-weight: bold;
            margin-top: 1em;
            margin-bottom: 0.5em;
            color: #374151;
        }
        .markdown-preview h3 {
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 0.75em;
            margin-bottom: 0.5em;
            color: #4b5563;
        }
        .markdown-preview p {
            margin-bottom: 0.75em;
        }
        .markdown-preview ul, .markdown-preview ol {
            margin-left: 1.5em;
            margin-bottom: 0.75em;
        }
        .markdown-preview li {
            margin-bottom: 0.25em;
        }
        .markdown-preview code {
            background: #e5e7eb;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
        }
        .markdown-preview pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 0.75em;
        }
        .markdown-preview pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }
        .markdown-preview blockquote {
            border-left: 4px solid #6366f1;
            padding-left: 16px;
            margin: 1em 0;
            color: #6b7280;
            font-style: italic;
        }
        .markdown-preview strong {
            font-weight: 600;
        }
        .markdown-preview em {
            font-style: italic;
        }
        .markdown-preview a {
            color: #6366f1;
            text-decoration: underline;
        }
        .markdown-preview hr {
            border: none;
            border-top: 1px solid #e5e7eb;
            margin: 1.5em 0;
        }

        /* Auto-save Indicator */
        .autosave-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
            color: #6b7280;
            z-index: 9997;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .autosave-indicator.visible {
            opacity: 1;
        }

        /* Template Card Styles */
        .template-card {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        .template-card:hover {
            border-color: #6366f1;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(99, 102, 241, 0.2);
        }
        .template-card.selected {
            border-color: #6366f1;
            background: #f0f0ff;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-purple-50 min-h-screen">
    <!-- Progress Bar -->
    <div class="progress-bar-container">
        <div id="progressBar" class="progress-bar" style="width: 0%"></div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Auto-save Indicator -->
    <div id="autosaveIndicator" class="autosave-indicator">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span id="autosaveText">Saved</span>
    </div>

    <!-- TD LLM API Connection Modal -->
    <div id="apiKeyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold text-gray-900 mb-4">üîå TD LLM API Status</h3>

            <!-- Connection status container -->
            <div id="apiModalStatusContainer" class="mb-6">
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl" id="connectionStatusIcon">‚è≥</span>
                        <div>
                            <p class="font-semibold text-gray-900" id="connectionStatusText">Checking Connection...</p>
                            <p class="text-sm text-gray-700" id="connectionStatusDetail">Testing connection to proxy server</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hidden inputs to maintain compatibility with existing JS -->
            <input type="hidden" id="agentIdInput" />
            <select id="tdModelSelect" class="hidden">
                <option value="anthropic.claude-3.5-sonnet">Claude 3.5 Sonnet</option>
            </select>

            <div class="flex gap-3 mb-3">
                <button
                    id="testConnectionBtn"
                    class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
                >
                    Test Connection
                </button>
                <button
                    id="closeApiModalBtn"
                    class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg transition-colors"
                >
                    Close
                </button>
            </div>

            <!-- Hidden button to maintain JS compatibility -->
            <button id="saveApiConfigBtn" class="hidden"></button>

            <p class="text-xs text-gray-500 mt-4 text-center">
                Powered by Treasure Data LLM API
            </p>
        </div>
    </div>

    <!-- Templates Modal -->
    <div id="templatesModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden overflow-y-auto">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full mx-4 my-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-900">üìã Agent Templates</h3>
                <button id="closeTemplatesModalBtn" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <p class="text-gray-600 mb-6">Choose a pre-configured template to get started quickly. All fields can be customized after loading.</p>

            <div id="templatesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto">
                <!-- Templates will be dynamically loaded here -->
            </div>

            <div class="mt-6 flex justify-between items-center">
                <a href="https://github.com/skwapong/PM-Agent-Squad-Master/issues/new?labels=template-submission&template=template_submission.md&title=%5BTemplate%5D+" target="_blank" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Submit Your Template
                </a>
                <button id="cancelTemplateBtn" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex items-center justify-center gap-3 mb-2">
                <img src="favicon.ico" alt="Treasure Data" class="w-12 h-12">
                <h1 class="text-4xl font-bold text-indigo-900" data-i18n="page.title">AI-Powered Agent Builder</h1>
            </div>
            <p class="text-gray-600" data-i18n="page.subtitle">Describe your agent, and I'll help you build it step-by-step</p>
            <div class="flex items-center justify-center gap-4 mt-2">
                <p class="text-sm text-gray-500">Powered by TD LLM API ‚Ä¢ Agent Builder Wizard</p>

                <!-- Global Language Settings -->
                <div class="flex items-center gap-2 bg-white rounded-full px-4 py-1 shadow-sm border border-gray-200">
                    <span class="text-xs text-gray-600">üåç</span>
                    <select id="globalLanguage" class="text-xs bg-transparent border-none focus:ring-0 focus:outline-none text-gray-700 font-medium cursor-pointer">
                        <option value="english">English</option>
                        <option value="japanese">Êó•Êú¨Ë™û</option>
                        <option value="multilingual">üåê Auto-Detect</option>
                        <option value="portuguese">Portugu√™s</option>
                        <option value="spanish">Espa√±ol</option>
                        <option value="french">Fran√ßais</option>
                        <option value="german">Deutsch</option>
                        <option value="italian">Italiano</option>
                        <option value="korean">ÌïúÍµ≠Ïñ¥</option>
                        <option value="dutch">Nederlands</option>
                    </select>
                </div>

                <button
                    id="configureApiBtn"
                    class="text-xs bg-indigo-100 hover:bg-indigo-200 text-indigo-700 px-3 py-1 rounded-full transition-colors"
                    title="Configure API Key"
                >
                    <span id="apiStatusIndicator">üî¥</span> API Settings
                </button>

                <button
                    id="templatesBtn"
                    class="text-xs bg-purple-100 hover:bg-purple-200 text-purple-700 px-3 py-1 rounded-full transition-colors"
                    title="Load Agent Templates"
                >
                    üìã Templates
                </button>

                <button
                    id="importConfigBtn"
                    class="text-xs bg-green-100 hover:bg-green-200 text-green-700 px-3 py-1 rounded-full transition-colors"
                    title="Import Agent Configuration"
                >
                    üì• Import
                </button>

                <button
                    id="exportConfigBtn"
                    class="text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-full transition-colors"
                    title="Export Agent Configuration"
                >
                    üì§ Export
                </button>

                <button
                    id="saveAgentBtn"
                    class="text-xs bg-amber-100 hover:bg-amber-200 text-amber-700 px-3 py-1 rounded-full transition-colors"
                    title="Save Agent to Repository"
                >
                    üíæ Save
                </button>

                <button
                    id="savedAgentsBtn"
                    class="text-xs bg-indigo-100 hover:bg-indigo-200 text-indigo-700 px-3 py-1 rounded-full transition-colors"
                    title="View Saved Agents Repository"
                >
                    üìö My Agents
                </button>

                <button
                    id="communityGalleryBtn"
                    class="text-xs bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white px-3 py-1 rounded-full transition-colors shadow-sm"
                    title="Browse Community Agent Gallery"
                >
                    üåê Community
                </button>
            </div>
        </div>

        <div id="draggableContainer" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Side: AI Assistant Panel -->
            <div id="assistantPanel" class="lg:col-span-1 draggable-section" draggable="false" data-section="assistant">
                <div class="bg-white rounded-lg shadow-lg p-6 sticky top-4 transition-all duration-200">
                    <div class="flex items-center gap-2 mb-4 pb-4 border-b border-gray-200">
                        <button class="drag-handle cursor-move text-gray-400 hover:text-gray-600 transition-colors" title="Drag to reorder">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path>
                            </svg>
                        </button>
                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center p-1 shadow-sm border border-gray-200">
                            <img src="favicon.ico" alt="TD" class="w-full h-full">
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-gray-900" data-i18n="assistant.title">Agent Foundry Assistant</h3>
                            <p class="text-xs text-gray-500" data-i18n="assistant.subtitle">Your agent building assistant</p>
                        </div>
                    </div>

                    <!-- Chat Messages -->
                    <div id="aiChatMessages" class="space-y-4 mb-4 max-h-96 overflow-y-auto">
                        <!-- Initial message -->
                        <div class="ai-message bg-gradient-to-br from-indigo-50 to-purple-50 rounded-lg p-4 border border-indigo-100">
                            <p class="text-sm text-gray-800" id="welcomeMessage">
                                <span data-i18n="assistant.welcome">üëã Hi! I'm your Agent Foundry Assistant. I'll help you build a custom AI Foundry Agent.</span>
                                <br><br>
                                <span data-i18n="assistant.start"><strong>Let's start:</strong> What kind of agent do you want to build? Describe what it should do.</span>
                            </p>
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div class="space-y-2">
                        <div class="flex justify-end mb-1">
                            <button
                                type="button"
                                id="expandChatInputBtn"
                                class="text-xs text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-1"
                                onclick="toggleChatInputModal()"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                                </svg>
                                Expand
                            </button>
                        </div>
                        <textarea
                            id="aiChatInput"
                            rows="3"
                            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"
                            placeholder="Example: I want to build a campaign planning agent that helps marketers create comprehensive marketing campaigns across multiple channels..."
                        ></textarea>
                        <!-- File attachment section -->
                        <div class="flex items-center gap-2 bg-gray-50 p-2 rounded">
                            <input type="file" id="chatAttachment" class="hidden" accept=".txt,.md,.json,.csv,.gdoc">
                            <button id="attachFileBtn" type="button" class="text-xs text-gray-600 hover:text-indigo-600 flex items-center gap-1 px-2 py-1 rounded hover:bg-white transition-colors">
                                üìé Attach File
                            </button>
                            <span id="attachmentName" class="text-xs text-gray-500 flex-1 truncate"></span>
                            <button id="removeAttachmentBtn" type="button" class="text-xs text-red-600 hover:text-red-700 hidden">‚úï Remove</button>
                        </div>
                        <!-- Error message for empty input -->
                        <div id="chatInputError" class="text-red-600 text-sm font-medium" style="display: none;">
                            ‚ö†Ô∏è Please enter a message or attach a file
                        </div>
                        <button
                            id="aiSendBtn"
                            class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200"
                            data-i18n="button.ask"
                        >
                            Ask Assistant
                        </button>
                        <button
                            id="aiStopBtn"
                            class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200"
                            style="display: none;"
                            data-i18n="button.stop"
                        >
                            ‚èπÔ∏è Stop Response
                        </button>
                        <button
                            id="aiGenerateBtn"
                            class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-200"
                            data-i18n="button.generate"
                        >
                            ‚ú® Auto-Generate Agent
                        </button>
                        <button
                            id="cancelGenerateBtn"
                            class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-200"
                            style="display: none;"
                            data-i18n="button.cancel"
                        >
                            ‚úñÔ∏è Cancel Generation
                        </button>
                        <button
                            id="resetBtn"
                            class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg transition-colors duration-200"
                            data-i18n="button.reset"
                        >
                            üîÑ Start Over
                        </button>
                    </div>

                    <!-- Generation Timer -->
                    <div id="generationTimer" class="mt-4 p-3 bg-indigo-50 border border-indigo-200 rounded-lg" style="display: none;">
                        <div class="text-xs text-indigo-600 font-semibold mb-2 flex items-center gap-2">
                            <div class="animate-pulse">‚è±Ô∏è</div>
                            <span>Generating Agent...</span>
                        </div>
                        <div class="flex justify-between text-xs text-gray-600 mb-1">
                            <span>Elapsed: <span id="elapsedTime" class="font-mono font-semibold">0s</span></span>
                            <span>Est: <span id="estimatedTime" class="font-mono">90-120s</span></span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-1.5 relative overflow-hidden">
                            <div id="progressBar" class="bg-gradient-to-r from-indigo-600 to-purple-600 h-1.5 rounded-full transition-all duration-300 relative" style="width: 0%">
                                <div class="absolute inset-0 bg-white opacity-30 animate-pulse"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <p class="text-xs font-semibold text-gray-600 mb-2" data-i18n="examples.title">Quick Examples:</p>
                        <div class="space-y-2">
                            <button class="quick-example w-full text-left text-xs bg-gray-50 hover:bg-gray-100 rounded px-3 py-2 transition-colors" data-example="campaign-building" data-i18n="example.campaign">
                                üéØ Campaign Building
                            </button>
                            <button class="quick-example w-full text-left text-xs bg-gray-50 hover:bg-gray-100 rounded px-3 py-2 transition-colors" data-example="campaign-optimization" data-i18n="example.optimization">
                                üìä Campaign Optimization
                            </button>
                            <button class="quick-example w-full text-left text-xs bg-gray-50 hover:bg-gray-100 rounded px-3 py-2 transition-colors" data-example="campaign-reporting" data-i18n="example.reporting">
                                üìà Campaign Reporting
                            </button>
                        </div>
                        <div class="mt-2 text-center">
                            <a href="#" id="clearAutoSaveLink" class="text-xs text-gray-500 hover:text-red-600 transition-colors">üóëÔ∏è Clear Auto-Save</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side: Wizard Steps -->
            <div id="wizardPanel" class="lg:col-span-2 draggable-section" draggable="false" data-section="wizard">
                <div class="transition-all duration-200">
                    <!-- Drag Handle -->
                    <div class="bg-white rounded-t-lg shadow-md p-2 flex items-center justify-center">
                        <button class="drag-handle cursor-move text-gray-400 hover:text-gray-600 transition-colors" title="Drag to reorder">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <!-- Progress Steps -->
                <div class="bg-white rounded-lg shadow-md p-4 mb-6">
                    <div class="flex items-center justify-between overflow-x-auto pb-2">
                        <div class="step-indicator active flex-1 text-center min-w-[60px]" data-step="0">
                            <div class="w-8 h-8 mx-auto bg-indigo-600 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">0</div>
                            <p class="text-xs font-medium" data-i18n="step.describe">Describe</p>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-1"></div>
                        <div class="step-indicator flex-1 text-center min-w-[70px]" data-step="1">
                            <div class="w-8 h-8 mx-auto bg-gray-300 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">1</div>
                            <p class="text-xs font-medium" data-i18n="step.knowledge">Knowledge</p>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-1"></div>
                        <div class="step-indicator flex-1 text-center min-w-[60px]" data-step="2">
                            <div class="w-8 h-8 mx-auto bg-gray-300 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">2</div>
                            <p class="text-xs font-medium" data-i18n="step.project">Project</p>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-1"></div>
                        <div class="step-indicator flex-1 text-center min-w-[60px]" data-step="3">
                            <div class="w-8 h-8 mx-auto bg-gray-300 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">3</div>
                            <p class="text-xs font-medium" data-i18n="step.agent">Agent</p>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-1"></div>
                        <div class="step-indicator flex-1 text-center min-w-[60px]" data-step="4">
                            <div class="w-8 h-8 mx-auto bg-gray-300 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">4</div>
                            <p class="text-xs font-medium" data-i18n="step.tools">Tools</p>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-1"></div>
                        <div class="step-indicator flex-1 text-center min-w-[60px]" data-step="5">
                            <div class="w-8 h-8 mx-auto bg-gray-300 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">5</div>
                            <p class="text-xs font-medium" data-i18n="step.outputs">Outputs</p>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-1"></div>
                        <div class="step-indicator flex-1 text-center min-w-[70px]" data-step="6">
                            <div class="w-8 h-8 mx-auto bg-gray-300 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">6</div>
                            <p class="text-xs font-medium" data-i18n="step.variables">Variables</p>
                        </div>
                        <div class="flex-1 h-1 bg-gray-200 mx-1"></div>
                        <div class="step-indicator flex-1 text-center min-w-[60px]" data-step="7">
                            <div class="w-8 h-8 mx-auto bg-gray-300 text-white rounded-full flex items-center justify-center text-sm font-bold mb-1">7</div>
                            <p class="text-xs font-medium" data-i18n="step.deploy">Deploy</p>
                        </div>
                    </div>
                </div>

                <!-- Main Content Card -->
                <div class="bg-white rounded-lg shadow-lg p-8">

                    <!-- Step 0: Describe Your Agent (NEW AI-First Step) -->
                    <div class="step-content active" data-step="0">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4" data-i18n="step0.title">üéØ Step 0: Describe Your Agent</h2>

                        <div class="bg-gradient-to-r from-indigo-50 to-purple-50 border-l-4 border-indigo-500 p-4 mb-6">
                            <p class="text-sm text-indigo-900" data-i18n="step0.info">
                                <strong>AI-Powered Building:</strong> Tell TD Agent Foundry what your agent needs to do, and it will automatically generate knowledge bases, configuration, and deployment files for you.
                            </p>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <label class="block text-sm font-medium text-gray-700">
                                        <span data-i18n="step0.purpose">What is your agent's purpose?</span> <span class="text-red-500">*</span>
                                    </label>
                                    <button
                                        type="button"
                                        id="expandDescriptionBtn"
                                        class="text-xs text-indigo-600 hover:text-indigo-700 font-medium flex items-center gap-1"
                                        onclick="toggleDescriptionModal()"
                                    >
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                                        </svg>
                                        Expand
                                    </button>
                                </div>
                                <textarea
                                    id="agentDescription"
                                    rows="6"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="Example: I need a campaign planning agent that helps marketers with:
- Creating comprehensive marketing campaign strategies
- Planning multi-channel campaigns (Meta, Google, TikTok, Pinterest)
- Optimizing campaign performance and budget allocation
- Analyzing campaign metrics and generating reports
- Providing best practices for paid media advertising

The agent should be strategic, data-driven, and provide actionable recommendations based on campaign planning frameworks and advertising best practices."
                                ></textarea>
                                <p class="text-xs text-gray-500 mt-1" data-i18n="step0.hint">
                                    Be specific! Include what the agent should do, who will use it, and what knowledge it needs.
                                </p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="step0.tone">
                                    What tone should your agent have?
                                </label>
                                <select id="agentTone" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    <option value="professional" data-i18n="tone.professional">Professional & Formal</option>
                                    <option value="friendly" data-i18n="tone.friendly">Friendly & Conversational</option>
                                    <option value="empathetic" data-i18n="tone.empathetic">Empathetic & Supportive</option>
                                    <option value="technical" data-i18n="tone.technical">Technical & Precise</option>
                                    <option value="enthusiastic" data-i18n="tone.enthusiastic">Enthusiastic & Energetic</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="step0.audience">
                                    Who will use this agent?
                                </label>
                                <input
                                    type="text"
                                    id="agentAudience"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="Example: Company employees, customers, internal team members..."
                                />
                            </div>

                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <p class="text-sm text-yellow-900" data-i18n="step0.tip">
                                    <strong>üí° Tip:</strong> The more detail you provide, the better the AI can generate your agent configuration. Include specific examples of questions users might ask or tasks they need help with.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 1: Knowledge Bases (AI-Generated) -->
                    <div class="step-content" data-step="1">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4" data-i18n="step1.title">üìö Step 1: Review Knowledge Bases</h2>

                        <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
                            <p class="text-sm text-green-900" data-i18n="step1.info">
                                <strong>‚ú® AI-Generated:</strong> Based on your description, TD Agent Foundry has created these knowledge bases for your agent. Review and edit as needed.
                            </p>
                        </div>

                        <div id="knowledgeBasesList" class="space-y-4">
                            <!-- AI-generated KBs will be inserted here -->
                            <div class="text-center py-12 text-gray-400">
                                <p>Complete Step 0 to generate knowledge bases</p>
                            </div>
                        </div>

                        <button
                            id="addKBBtn"
                            class="mt-4 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 font-semibold py-2 px-4 rounded-lg transition-colors duration-200"
                            data-i18n="button.addkb"
                        >
                            ‚ûï Add Another Knowledge Base
                        </button>
                    </div>

                    <!-- Step 2: Project Setup (AI-Generated) -->
                    <div class="step-content" data-step="2">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4" data-i18n="step2.title">‚öôÔ∏è Step 2: Review Project Setup</h2>

                        <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
                            <p class="text-sm text-green-900" data-i18n="step2.info">
                                <strong>‚ú® AI-Generated:</strong> TD Agent Foundry has configured your project settings. Review and modify if needed.
                            </p>
                            <p class="text-sm text-green-900 mt-2" data-i18n="step2.next">
                                <strong>üìç Next Step:</strong> After completing this wizard, open <a href="https://console.treasuredata.com/app/agents" target="_blank" class="text-indigo-600 hover:text-indigo-800 underline font-semibold">Treasure Data ‚Üí AI Agent Foundry</a> to deploy your agent.
                            </p>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <span data-i18n="step2.name">Project Name</span> <span class="text-red-500">*</span>
                                </label>
                                <input
                                    type="text"
                                    id="projectName"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="Example: Employee HR Support System"
                                />
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <span data-i18n="step2.description">Project Description</span> <span class="text-red-500">*</span>
                                </label>
                                <textarea
                                    id="projectDescription"
                                    rows="4"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="Comprehensive description of your project..."
                                ></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Agent Configuration (AI-Generated) -->
                    <div class="step-content" data-step="3">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4" data-i18n="step3.title">ü§ñ Step 3: Review Agent Configuration</h2>

                        <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
                            <p class="text-sm text-green-900" data-i18n="step3.info">
                                <strong>‚ú® AI-Generated:</strong> TD Agent Foundry has selected optimal settings for your agent. Customize if needed.
                            </p>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <span data-i18n="step3.name">Agent Display Name</span> <span class="text-red-500">*</span>
                                </label>
                                <input
                                    type="text"
                                    id="agentName"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                />
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <span data-i18n="step3.model">AI Model</span> <span class="text-red-500">*</span>
                                </label>
                                <select id="modelSelect" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    <!-- Top 3 Recommendations -->
                                    <optgroup label="üèÜ Recommended (Top 3)">
                                        <option value="anthropic.claude-4.5-sonnet">ü•á Claude 4.5 Sonnet - Best Overall</option>
                                        <option value="anthropic.claude-3-5-haiku-20241022-v1:0">ü•à Claude 3.5 Haiku - Fast & Cost-Effective</option>
                                        <option value="openai.gpt-4o">ü•â GPT-4o - OpenAI Flagship</option>
                                    </optgroup>

                                    <!-- Anthropic Claude -->
                                    <optgroup label="Anthropic Claude">
                                        <option value="anthropic.claude-4-opus">Claude 4 Opus - Highest Capability</option>
                                        <option value="anthropic.claude-4.5-sonnet">Claude 4.5 Sonnet - Latest Balanced</option>
                                        <option value="anthropic.claude-4.5-haiku">Claude 4.5 Haiku - Fast & Efficient</option>
                                        <option value="anthropic.claude-4-sonnet">Claude 4 Sonnet - Latest Generation</option>
                                        <option value="anthropic.claude-3.7-sonnet">Claude 3.7 Sonnet - Enhanced</option>
                                        <option value="anthropic.claude-3-5-sonnet-20241022-v2:0">Claude 3.5 Sonnet V2 - Recommended</option>
                                        <option value="anthropic.claude-3-5-sonnet">Claude 3.5 Sonnet - Previous Gen</option>
                                        <option value="anthropic.claude-3-5-haiku-20241022-v1:0">Claude 3.5 Haiku</option>
                                        <option value="anthropic.claude-3-haiku">Claude 3 Haiku - Legacy Fast</option>
                                        <option value="anthropic.claude-3-opus-20240229-v1:0">Claude 3 Opus (Superseded)</option>
                                    </optgroup>

                                    <!-- OpenAI GPT -->
                                    <optgroup label="OpenAI GPT">
                                        <option value="openai.gpt-5">GPT-5 - Latest Generation</option>
                                        <option value="openai.gpt-5-mini">GPT-5 Mini - Smaller, Faster</option>
                                        <option value="openai.gpt-5-nano">GPT-5 Nano - Minimal Size</option>
                                        <option value="openai.gpt-4.1">GPT-4.1 - Previous Generation</option>
                                        <option value="openai.gpt-4.1-mini">GPT-4.1 Mini - Compact Version</option>
                                        <option value="openai.gpt-4.1-nano">GPT-4.1 Nano - Smallest Version</option>
                                        <option value="openai.gpt-4o">GPT-4o</option>
                                        <option value="openai.gpt-4o-mini">GPT-4o Mini</option>
                                        <option value="openai.gpt-4-turbo-2024-04-09">GPT-4 Turbo (Superseded)</option>
                                    </optgroup>

                                    <!-- Amazon Bedrock / Nova -->
                                    <optgroup label="Amazon Bedrock / Nova">
                                        <option value="amazon.nova-pro-v1:0">Amazon Nova Pro - High Performance</option>
                                        <option value="amazon.nova-lite-v1:0">Amazon Nova Lite - Lightweight</option>
                                        <option value="amazon.nova-micro-v1:0">Amazon Nova Micro - Minimal (Not Recommended)</option>
                                    </optgroup>

                                    <!-- Meta Llama -->
                                    <optgroup label="Meta Llama">
                                        <option value="meta.llama-4-maverick-17b">Llama 4 Maverick 17B - Advanced Reasoning</option>
                                        <option value="meta.llama-4-scout-17b">Llama 4 Scout 17B - Fast Inference</option>
                                        <option value="meta.llama3-1-405b-instruct-v1:0">Llama 3.1 405B Instruct</option>
                                        <option value="meta.llama3-1-70b-instruct-v1:0">Llama 3.1 70B Instruct</option>
                                        <option value="meta.llama3-1-8b-instruct-v1:0">Llama 3.1 8B Instruct (Not Recommended)</option>
                                    </optgroup>

                                    <!-- Google Gemini -->
                                    <optgroup label="Google Gemini">
                                        <option value="google.gemini-2.5-pro">Gemini 2.5 Pro - High Capability</option>
                                        <option value="google.gemini-2.5-flash">Gemini 2.5 Flash - Fast Responses</option>
                                        <option value="google.gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite - Lightweight</option>
                                        <option value="google.gemini-2.0-flash-lite">Gemini 2.0 Flash-Lite - Legacy Fast</option>
                                    </optgroup>

                                    <!-- Mistral AI -->
                                    <optgroup label="Mistral AI">
                                        <option value="mistral.mistral-large-2411-v1:0">Mistral Large 2 (24.11)</option>
                                        <option value="mistral.mistral-small-2409-v1:0">Mistral Small (24.09)</option>
                                    </optgroup>
                                </select>
                                <p id="modelRecommendation" class="text-xs mt-1"></p>
                                <p id="modelWarning" class="text-xs text-amber-600 mt-1 hidden"></p>

                                <!-- AI Model Reasoning -->
                                <div id="modelReasoningSection" class="mt-3 p-3 bg-indigo-50 border border-indigo-200 rounded-lg" style="display: none;">
                                    <div class="flex items-start gap-2">
                                        <span class="text-indigo-600 text-sm">üí°</span>
                                        <div>
                                            <p class="text-xs font-semibold text-indigo-900 mb-1">Why this model?</p>
                                            <p id="modelReasoningText" class="text-xs text-indigo-700"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="step3.temperature">
                                    Temperature
                                </label>
                                <div class="flex items-center gap-3">
                                    <input
                                        type="range"
                                        id="temperature"
                                        min="0"
                                        max="1"
                                        step="0.1"
                                        value="0.5"
                                        class="flex-1"
                                    />
                                    <input
                                        type="number"
                                        id="temperatureInput"
                                        min="0"
                                        max="1"
                                        step="0.1"
                                        value="0.5"
                                        class="w-20 border border-gray-300 rounded-lg px-3 py-1.5 text-center text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    />
                                </div>
                                <p class="text-xs text-gray-500 mt-1" data-i18n="step3.temp.tip">
                                    Controls randomness: 0.0-1.0. Lower = More precise | Higher = More creative
                                </p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="step3.maxToolsIterations">
                                    Max Tools Iterations
                                </label>
                                <div class="flex items-center gap-3">
                                    <input
                                        type="range"
                                        id="maxToolsIterations"
                                        min="0"
                                        max="10"
                                        step="1"
                                        value="0"
                                        class="flex-1"
                                    />
                                    <input
                                        type="number"
                                        id="maxToolsIterationsInput"
                                        min="0"
                                        max="10"
                                        step="1"
                                        value="0"
                                        class="w-20 border border-gray-300 rounded-lg px-3 py-1.5 text-center text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    />
                                </div>
                                <p class="text-xs text-gray-500 mt-1" data-i18n="step3.maxToolsIterations.tip">
                                    Tool iterations allow the agent to refine and improve tool calls. Range: 0-10 (0 = no iterations)
                                </p>
                            </div>

                            <div>
                                <div class="flex items-center justify-between mb-2">
                                    <label class="block text-sm font-medium text-gray-700">
                                        <span data-i18n="step3.prompt">System Prompt</span> <span class="text-red-500">*</span>
                                    </label>
                                    <button id="toggleSystemPromptPreview" class="text-xs text-indigo-600 hover:text-indigo-700 flex items-center gap-1">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                        Preview
                                    </button>
                                </div>
                                <textarea
                                    id="systemPrompt"
                                    rows="8"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-2 font-mono text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    maxlength="9000"
                                ></textarea>
                                <div id="systemPromptPreview" class="markdown-preview hidden mt-2"></div>
                                <div class="flex justify-between items-center mt-1">
                                    <div class="flex items-center gap-2">
                                        <p class="text-xs text-gray-500" data-i18n="step3.prompt.tip">AI-generated system prompt based on your description</p>
                                        <span id="systemPromptCharCount" class="text-xs font-medium text-gray-600">0 / 9000</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button id="refinePromptBtn" class="text-xs text-purple-600 hover:text-purple-700 font-medium" title="Get AI suggestions to improve this prompt">
                                            ‚ú® Refine with AI
                                        </button>
                                        <button id="regeneratePromptBtn" class="text-xs text-indigo-600 hover:text-indigo-700" data-i18n="button.regenerate">
                                            üîÑ Regenerate
                                        </button>
                                    </div>
                                </div>
                                <div id="systemPromptWarning" class="mt-2 text-xs text-amber-600 font-medium hidden">
                                    ‚ö†Ô∏è System prompt is approaching the 9000 character limit
                                </div>
                                <div id="systemPromptError" class="mt-2 text-xs text-red-600 font-medium hidden">
                                    ‚ùå System prompt exceeds 9000 character limit and will be truncated
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Tools Review -->
                    <div class="step-content" data-step="4">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4">üîß Step 4: Review & Add Tools</h2>

                        <p class="text-gray-700 mb-4">
                            Review auto-generated Knowledge Base tools and optionally add specialized tools to extend your agent's capabilities.
                        </p>

                        <!-- Auto-Generated KB Tools Section -->
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold text-gray-900 mb-3">üìö Auto-Generated Knowledge Base Tools</h3>
                            <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-4">
                                <p class="text-sm text-green-900">
                                    <strong>‚úÖ Auto-Generated:</strong> These tools were created from your knowledge bases. They allow your agent to search and retrieve information.
                                </p>
                            </div>

                            <div id="knowledgeBaseToolsList" class="space-y-3">
                                <!-- Auto-generated KB tools will be displayed here -->
                            </div>
                        </div>

                        <!-- Additional Tools Section -->
                        <div class="border-t pt-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-3">üõ†Ô∏è Additional Specialized Tools (Optional)</h3>
                            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                                <p class="text-sm text-blue-900">
                                    <strong>‚ÑπÔ∏è Optional:</strong> Add specialized tools like Agent calls, Image Generation, or Workflow Execution.
                                </p>
                            </div>

                            <div id="additionalToolsList" class="space-y-4 mb-4">
                                <!-- Manually-added tools will be added here -->
                            </div>

                            <button id="addToolBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                                ‚ûï Add Specialized Tool
                            </button>

                            <div class="mt-4 bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-2">Available Tool Types:</h4>
                                <ul class="text-sm text-gray-700 space-y-2">
                                    <li><strong>Agent Tool:</strong> Call another specialized agent</li>
                                    <li><strong>Image Generator:</strong> Create or edit images</li>
                                    <li><strong>Workflow Executor:</strong> Run complex multi-step workflows</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5: Configure Outputs (Optional) -->
                    <div class="step-content" data-step="5">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4">üì§ Step 5: Review & Configure Outputs</h2>

                        <p class="text-gray-700 mb-4">
                            Review auto-generated structured outputs and add more if needed. Your agent always returns text by default.
                        </p>

                        <!-- Default Output Section -->
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold text-gray-900 mb-3">üìù Default Text Output</h3>
                            <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-4">
                                <p class="text-sm text-green-900">
                                    <strong>‚úÖ Always Available:</strong> Your agent will automatically return text responses with markdown formatting support. No configuration needed!
                                </p>
                            </div>

                            <div class="bg-white border border-gray-200 rounded-lg p-4">
                                <div class="flex items-start gap-3">
                                    <div class="flex-shrink-0 text-2xl">‚úÖ</div>
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-gray-900 mb-2">Default Capabilities:</h4>
                                        <ul class="text-sm text-gray-700 space-y-1.5">
                                            <li>‚Ä¢ Returns natural language responses</li>
                                            <li>‚Ä¢ Supports markdown formatting (bold, italic, lists, code blocks)</li>
                                            <li>‚Ä¢ No setup required - works out of the box</li>
                                            <li>‚Ä¢ Perfect for conversational agents and general Q&A</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Auto-Generated Outputs Section -->
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold text-gray-900 mb-3">üé® Auto-Generated Structured Outputs</h3>
                            <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-4">
                                <p class="text-sm text-green-900">
                                    <strong>‚úÖ Auto-Generated:</strong> These structured outputs were created based on your agent's description. You can customize function names, descriptions, and JSON schemas as needed.
                                </p>
                            </div>

                            <div id="autoGeneratedOutputsList" class="space-y-3">
                                <!-- Auto-generated outputs will be rendered here -->
                            </div>
                        </div>

                        <!-- Additional Custom Outputs Section -->
                        <div class="border-t pt-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-3">‚ûï Additional Custom Outputs (Optional)</h3>
                            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                                <p class="text-sm text-blue-900">
                                    <strong>‚ÑπÔ∏è Optional:</strong> Add more custom outputs when you need additional structured data, charts, or special formatting beyond what was auto-generated.
                                </p>
                            </div>

                            <div id="outputsList" class="space-y-4 mb-4">
                                <!-- Additional manual outputs will be added here -->
                            </div>

                            <button id="addOutputBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                                ‚ûï Add Custom Output
                            </button>

                            <div class="mt-4 bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">Available Output Types:</h4>

                                <div class="space-y-3">
                                    <div class="bg-white border border-gray-200 rounded p-3">
                                        <h5 class="font-semibold text-gray-900 text-sm mb-1">üìä Custom (JSON)</h5>
                                        <p class="text-xs text-gray-600 mb-2">Structured data with custom schema</p>
                                        <p class="text-xs text-gray-700">
                                            <strong>Use for:</strong> API integrations, database inserts, structured reports<br>
                                            <strong>Example:</strong> Campaign plans, product catalogs, analytics data
                                        </p>
                                    </div>

                                    <div class="bg-white border border-gray-200 rounded p-3">
                                        <h5 class="font-semibold text-gray-900 text-sm mb-1">üìÑ Artifact (Text)</h5>
                                        <p class="text-xs text-gray-600 mb-2">Formatted documents and reports</p>
                                        <p class="text-xs text-gray-700">
                                            <strong>Use for:</strong> Long-form content, documentation, formatted reports<br>
                                            <strong>Example:</strong> Marketing briefs, strategy documents, proposals
                                        </p>
                                    </div>

                                    <div class="bg-white border border-gray-200 rounded p-3">
                                        <h5 class="font-semibold text-gray-900 text-sm mb-1">üñºÔ∏è Artifact (Image)</h5>
                                        <p class="text-xs text-gray-600 mb-2">Visual content generation</p>
                                        <p class="text-xs text-gray-700">
                                            <strong>Use for:</strong> Generated images, diagrams, visual assets<br>
                                            <strong>Example:</strong> Social media graphics, infographics
                                        </p>
                                    </div>

                                    <div class="bg-white border border-gray-200 rounded p-3">
                                        <h5 class="font-semibold text-gray-900 text-sm mb-1">üìà Artifact (React/Plotly)</h5>
                                        <p class="text-xs text-gray-600 mb-2">Interactive charts and visualizations</p>
                                        <p class="text-xs text-gray-700">
                                            <strong>Use for:</strong> Data visualization, interactive dashboards<br>
                                            <strong>Example:</strong> Performance charts, trend graphs, analytics dashboards<br>
                                            <strong>üí° Tip:</strong> Name output ":plotly:" to auto-render charts
                                        </p>
                                    </div>
                                </div>

                                <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded">
                                    <p class="text-xs text-yellow-900">
                                        <strong>‚ö° Pro Tip:</strong> Start with default text output. Only add custom outputs when you need specific data structures or visualizations.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 6: Prompt Variables (Optional) -->
                    <div class="step-content" data-step="6">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4">üìã Step 6: Prompt Variables (Optional)</h2>

                        <p class="text-gray-700 mb-4">
                            Inject dynamic data from knowledge bases directly into your agent's prompts.
                        </p>

                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                            <p class="text-sm text-blue-900">
                                <strong>‚ÑπÔ∏è Note:</strong> Prompt variables are optional. Use them to provide schema context from your databases.
                            </p>
                        </div>

                        <div id="promptVariablesList" class="space-y-4 mb-6">
                            <!-- Prompt variables will be added here -->
                        </div>

                        <button id="addPromptVariableBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            ‚ûï Add Prompt Variable
                        </button>

                        <div class="mt-6 bg-gray-50 rounded-lg p-4">
                            <h3 class="font-semibold text-gray-900 mb-2">Syntax Examples:</h3>
                            <ul class="text-sm font-mono text-gray-700 space-y-1">
                                <li>customers - All columns from customers table</li>
                                <li>products.{sku,name,price} - Only specified columns</li>
                                <li>behavior_*.* - All tables starting with "behavior_"</li>
                                <li>!*.internal_* - Exclude columns starting with "internal_"</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Step 7: Download & Deploy -->
                    <div class="step-content" data-step="7">
                        <h2 class="text-2xl font-bold text-indigo-900 mb-4" data-i18n="step4.title">üöÄ Step 7: Download & Deploy</h2>

                        <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-6">
                            <p class="text-sm text-green-900" data-i18n="step4.info">
                                <strong>‚úÖ Configuration Complete!</strong> Your AI agent is ready to deploy. Download all files and follow the deployment guide.
                            </p>
                        </div>

                        <div id="configSummary" class="bg-gray-50 rounded-lg p-6 mb-6">
                            <!-- Configuration summary will be inserted here -->
                        </div>

                        <!-- Session Statistics -->
                        <div id="sessionStats" class="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-indigo-200 rounded-lg p-6 mb-6">
                            <h3 class="text-lg font-bold text-indigo-900 mb-4 flex items-center gap-2">
                                <span>üìä</span>
                                <span>Session Statistics</span>
                            </h3>

                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <!-- Time Taken -->
                                <div class="bg-white rounded-lg p-4 shadow-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl">‚è±Ô∏è</span>
                                        <span class="text-sm font-medium text-gray-600">Total Time</span>
                                    </div>
                                    <div id="totalTimeValue" class="text-2xl font-bold text-indigo-900">--</div>
                                    <div id="aiTimeValue" class="text-xs text-gray-500 mt-1">AI Generation: --</div>
                                </div>

                                <!-- Tokens Used -->
                                <div class="bg-white rounded-lg p-4 shadow-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl">üéØ</span>
                                        <span class="text-sm font-medium text-gray-600">Tokens Used</span>
                                    </div>
                                    <div id="totalTokensValue" class="text-2xl font-bold text-indigo-900">--</div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        <span id="inputTokensValue">Input: --</span> ‚Ä¢
                                        <span id="outputTokensValue">Output: --</span>
                                    </div>
                                </div>

                                <!-- Estimated Cost -->
                                <div class="bg-white rounded-lg p-4 shadow-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl">üí∞</span>
                                        <span class="text-sm font-medium text-gray-600">Estimated Cost</span>
                                    </div>
                                    <div id="estimatedCostValue" class="text-2xl font-bold text-indigo-900">--</div>
                                    <div class="text-xs text-gray-500 mt-1">TD LLM API</div>
                                </div>

                                <!-- Components Generated -->
                                <div class="bg-white rounded-lg p-4 shadow-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl">üì¶</span>
                                        <span class="text-sm font-medium text-gray-600">Components</span>
                                    </div>
                                    <div id="componentsValue" class="text-2xl font-bold text-indigo-900">--</div>
                                    <div class="text-xs text-gray-500 mt-1" id="componentsBreakdown">--</div>
                                </div>

                                <!-- API Calls -->
                                <div class="bg-white rounded-lg p-4 shadow-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl">üîÑ</span>
                                        <span class="text-sm font-medium text-gray-600">API Calls</span>
                                    </div>
                                    <div id="apiCallsValue" class="text-2xl font-bold text-indigo-900">--</div>
                                    <div class="text-xs text-gray-500 mt-1">to TD LLM API</div>
                                </div>

                                <!-- Character Count -->
                                <div class="bg-white rounded-lg p-4 shadow-sm">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-2xl">üìù</span>
                                        <span class="text-sm font-medium text-gray-600">Content Generated</span>
                                    </div>
                                    <div id="contentSizeValue" class="text-2xl font-bold text-indigo-900">--</div>
                                    <div class="text-xs text-gray-500 mt-1">characters</div>
                                </div>
                            </div>

                            <div class="mt-4 p-3 bg-white/50 rounded-lg">
                                <p class="text-xs text-gray-600">
                                    <strong>üí° Note:</strong> Token counts and costs are estimates based on character count.
                                    Actual usage may vary slightly. Pricing varies by model.
                                </p>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <!-- Optimize & Test Agent Buttons -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
                                <button id="optimizeAgentBtn" class="bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white font-semibold py-4 px-4 rounded-lg transition-all duration-200 shadow-lg flex items-center justify-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                    </svg>
                                    <span>AI Optimize Agent</span>
                                </button>
                                <button id="testAgentBtn" class="bg-gradient-to-r from-green-500 to-teal-600 hover:from-green-600 hover:to-teal-700 text-white font-semibold py-4 px-4 rounded-lg transition-all duration-200 shadow-lg flex items-center justify-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                                    </svg>
                                    <span>Test Agent</span>
                                </button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <button id="viewOutputBtn" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-4 px-4 rounded-lg transition-colors duration-200 shadow-lg" data-i18n="button.viewoutput">
                                    üìÑ View Output Webpage
                                </button>
                                <button id="shareOutputBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-4 rounded-lg transition-colors duration-200 shadow-lg">
                                    üíæ Download Shareable HTML
                                </button>
                            </div>

                            <button id="downloadKBsBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200" data-i18n="button.downloadkbs">
                                üìö Download Knowledge Base Files (.md)
                            </button>
                            <button id="downloadProjectBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200" data-i18n="button.downloadproject">
                                üìã Download Project Setup Guide
                            </button>
                            <button id="downloadAgentBtn" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200" data-i18n="button.downloadagent">
                                ü§ñ Download Agent Configuration
                            </button>
                            <button id="downloadAllBtn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 px-4 rounded-lg transition-all duration-200" data-i18n="button.downloadall">
                                üì¶ Download All Files (ZIP)
                            </button>

                            <!-- Auto-Deploy Button (Coming Soon) -->
                            <button disabled class="w-full bg-gray-300 text-gray-500 font-semibold py-3 px-4 rounded-lg cursor-not-allowed opacity-60 relative">
                                <span data-i18n="button.autodeploy">üöÄ Auto-Deploy to Agent Foundry</span>
                                <span class="ml-2 text-xs bg-gray-400 text-white px-2 py-1 rounded" data-i18n="deploy.comingsoon">Coming Soon</span>
                            </button>
                        </div>

                        <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h3 class="font-semibold text-blue-900 mb-2" data-i18n="deploy.steps">üìñ Next Steps:</h3>
                            <ol class="list-decimal list-inside text-sm text-blue-800 space-y-1">
                                <li data-i18n="deploy.step1">Download all files to your computer</li>
                                <li data-i18n="deploy.step2">Open Agent Foundry</li>
                                <li data-i18n="deploy.step3">Create new project (use PROJECT_SETUP.md guide)</li>
                                <li data-i18n="deploy.step4">Upload knowledge base files</li>
                                <li data-i18n="deploy.step5">Configure agent (use AGENT_CONFIG.md guide)</li>
                                <li data-i18n="deploy.step6">Test and deploy your agent!</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200">
                        <button
                            id="prevBtn"
                            class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled
                            data-i18n="button.previous"
                        >
                            ‚Üê Previous
                        </button>
                        <div class="text-sm text-gray-500">
                            <span data-i18n="step.of">Step</span> <span id="currentStepNum">0</span> <span data-i18n="step.total">of 8</span>
                        </div>
                        <button
                            id="nextBtn"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                            data-i18n="button.next"
                        >
                            Next ‚Üí
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scroll Navigation Buttons -->
    <button id="scrollToTopBtn" class="fixed bottom-24 right-6 bg-indigo-600 hover:bg-indigo-700 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center transition-all duration-300 opacity-0 pointer-events-none z-50" title="Scroll to top">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
    </button>
    <button id="scrollToBottomBtn" class="fixed bottom-6 right-6 bg-indigo-600 hover:bg-indigo-700 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center transition-all duration-300 z-50" title="Scroll to bottom">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
        </svg>
    </button>

    <!-- Description Expand Modal -->
    <div id="descriptionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Agent Purpose & Description</h3>
                <button
                    onclick="toggleDescriptionModal()"
                    class="text-gray-400 hover:text-gray-600 text-2xl leading-none"
                >&times;</button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <textarea
                    id="modalDescription"
                    rows="20"
                    class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none h-full"
                    placeholder="Describe your agent's purpose, capabilities, and requirements in detail..."
                ></textarea>
            </div>
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button
                    onclick="toggleDescriptionModal()"
                    class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                >Cancel</button>
                <button
                    onclick="saveDescriptionFromModal()"
                    class="px-4 py-2 text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors font-medium"
                >Save & Close</button>
            </div>
        </div>
    </div>

    <!-- Chat Input Expand Modal -->
    <div id="chatInputModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Describe Your Agent</h3>
                <button
                    onclick="toggleChatInputModal()"
                    class="text-gray-400 hover:text-gray-600 text-2xl leading-none"
                >&times;</button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <textarea
                    id="modalChatInput"
                    rows="20"
                    class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none h-full"
                    placeholder="Example: I want to build a campaign planning agent that helps marketers create comprehensive marketing campaigns across multiple channels (Meta, Google, TikTok, Pinterest). The agent should help with campaign strategy, budget allocation, audience targeting, creative direction, and performance analytics. It should provide actionable recommendations based on industry best practices and data-driven insights."
                ></textarea>
            </div>
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button
                    onclick="toggleChatInputModal()"
                    class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                >Cancel</button>
                <button
                    onclick="saveChatInputFromModal()"
                    class="px-4 py-2 text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors font-medium"
                >Save & Close</button>
            </div>
        </div>
    </div>

    <!-- Optimize Agent Modal -->
    <div id="optimizeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                    <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    AI Agent Optimization Analysis
                </h3>
                <button
                    onclick="closeOptimizeModal()"
                    class="text-gray-400 hover:text-gray-600 text-2xl leading-none"
                >&times;</button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <div id="optimizationResults" class="space-y-4">
                    <!-- Loading state -->
                    <div id="optimizeLoading" class="text-center py-12">
                        <div class="inline-flex items-center gap-3">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-amber-600"></div>
                            <span class="text-gray-600">Analyzing your agent configuration...</span>
                        </div>
                    </div>
                    <!-- Results will be inserted here -->
                </div>
            </div>
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button
                    onclick="closeOptimizeModal()"
                    class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                >Close</button>
            </div>
        </div>
    </div>

    <!-- Test Agent Modal -->
    <div id="testAgentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                    </svg>
                    Test Your Agent - <span id="testAgentName" class="text-indigo-600">Agent Name</span>
                </h3>
                <button
                    onclick="closeTestAgentModal()"
                    class="text-gray-400 hover:text-gray-600 text-2xl leading-none"
                >&times;</button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 bg-gray-50">
                <!-- Sample Queries -->
                <div class="mb-4 bg-white rounded-lg p-4 border border-gray-200">
                    <h4 class="font-semibold text-sm text-gray-700 mb-2">üí° Try these sample queries:</h4>
                    <div id="sampleQueries" class="flex flex-wrap gap-2">
                        <!-- Sample queries will be inserted here -->
                    </div>
                </div>

                <!-- Chat Interface -->
                <div id="testChatMessages" class="space-y-3 mb-4 min-h-[300px]">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <p class="text-sm text-blue-900">
                            <strong>üëã Welcome!</strong> This is a simulation of how your agent will respond.
                            Try asking questions related to: <strong id="testAgentDomain" class="text-blue-700"></strong>
                        </p>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="bg-white rounded-lg p-4 border border-gray-200">
                    <textarea
                        id="testChatInput"
                        rows="3"
                        class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"
                        placeholder="Ask your agent a question..."
                    ></textarea>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-xs text-gray-500">Press Enter to send (Shift+Enter for new line)</span>
                        <button
                            id="testSendBtn"
                            onclick="sendTestMessage()"
                            class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
                        >Send</button>
                    </div>
                </div>
            </div>
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button
                    onclick="clearTestChat()"
                    class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                >Clear Chat</button>
                <button
                    onclick="closeTestAgentModal()"
                    class="px-4 py-2 text-white bg-green-600 hover:bg-green-700 rounded-lg transition-colors"
                >Done Testing</button>
            </div>
        </div>
    </div>

    <!-- Refine System Prompt Modal -->
    <div id="refinePromptModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                    AI System Prompt Refinement
                </h3>
                <button onclick="closeRefinePromptModal()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <div id="refinePromptResults" class="space-y-4">
                    <div id="refinePromptLoading" class="text-center py-12">
                        <div class="inline-flex items-center gap-3">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
                            <span class="text-gray-600">Analyzing your system prompt...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Saved Agents Repository Modal -->
    <div id="savedAgentsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                    <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                    </svg>
                    My Saved Agents
                    <span id="savedAgentsCount" class="bg-indigo-100 text-indigo-700 text-xs px-2 py-0.5 rounded-full">0</span>
                </h3>
                <button onclick="closeSavedAgentsModal()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <!-- Search and Filter -->
                <div class="mb-4 flex gap-3">
                    <input type="text" id="searchSavedAgents" placeholder="Search saved agents..." class="flex-1 border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    <select id="sortSavedAgents" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="name">Name A-Z</option>
                    </select>
                </div>

                <!-- Saved Agents List -->
                <div id="savedAgentsList" class="space-y-3">
                    <!-- Agents will be dynamically loaded here -->
                    <div class="text-center py-12 text-gray-400">
                        <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                        <p class="text-lg font-medium">No saved agents yet</p>
                        <p class="text-sm mt-1">Save your first agent to see it here</p>
                    </div>
                </div>
            </div>
            <div class="flex justify-between items-center p-6 border-t border-gray-200">
                <button onclick="clearAllSavedAgents()" class="text-red-600 hover:text-red-700 text-sm font-medium">
                    Clear All
                </button>
                <button onclick="closeSavedAgentsModal()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Save Agent Modal -->
    <div id="saveAgentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                    <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                    </svg>
                    Save Agent to Repository
                </h3>
                <button onclick="closeSaveAgentModal()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Agent Name <span class="text-red-500">*</span></label>
                        <input type="text" id="saveAgentName" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="My Campaign Agent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description (optional)</label>
                        <textarea id="saveAgentDescription" rows="2" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none" placeholder="Brief description of this agent..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tags (optional)</label>
                        <input type="text" id="saveAgentTags" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="marketing, campaign, ads">
                        <p class="text-xs text-gray-500 mt-1">Comma-separated tags for easy filtering</p>
                    </div>
                </div>
            </div>
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button onclick="closeSaveAgentModal()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                    Cancel
                </button>
                <button onclick="confirmSaveAgent()" class="px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-colors font-medium">
                    üíæ Save Agent
                </button>
            </div>
        </div>
    </div>

    <!-- Share Agent Modal -->
    <div id="shareAgentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                    </svg>
                    Share Agent
                </h3>
                <button onclick="closeShareAgentModal()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
            </div>
            <div class="p-6">
                <p class="text-sm text-gray-600 mb-4">Share this agent with colleagues by copying the share code below. They can import it using the "Import Shared Agent" option.</p>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Agent Name</label>
                    <p id="shareAgentName" class="text-gray-900 font-semibold"></p>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Share Code</label>
                    <div class="relative">
                        <textarea id="shareCodeOutput" rows="4" readonly class="w-full border border-gray-300 rounded-lg px-4 py-2 text-xs font-mono bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                        <button onclick="copyShareCode()" class="absolute top-2 right-2 bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1 rounded transition-colors">
                            üìã Copy
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">This code contains the full agent configuration</p>
                </div>

                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <p class="text-xs text-blue-800">
                        <strong>üí° Tip:</strong> You can also download the agent as a JSON file for backup or sharing via email/Slack.
                    </p>
                </div>
            </div>
            <div class="flex justify-between gap-3 p-6 border-t border-gray-200">
                <button onclick="downloadSharedAgent()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                    Download JSON
                </button>
                <button onclick="closeShareAgentModal()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium">
                    Done
                </button>
            </div>
        </div>
    </div>

    <!-- Import Shared Agent Modal -->
    <div id="importSharedAgentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                    </svg>
                    Import Shared Agent
                </h3>
                <button onclick="closeImportSharedAgentModal()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
            </div>
            <div class="p-6">
                <p class="text-sm text-gray-600 mb-4">Paste a share code from a colleague to import their agent configuration.</p>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Share Code</label>
                    <textarea id="importShareCodeInput" rows="5" class="w-full border border-gray-300 rounded-lg px-4 py-2 text-xs font-mono focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Paste the share code here..."></textarea>
                </div>

                <div id="importPreview" class="hidden mb-4 bg-green-50 border border-green-200 rounded-lg p-4">
                    <h4 class="font-semibold text-green-900 mb-2">Agent Preview</h4>
                    <div class="text-sm text-green-800">
                        <p><strong>Name:</strong> <span id="importPreviewName"></span></p>
                        <p><strong>Description:</strong> <span id="importPreviewDesc"></span></p>
                        <p><strong>Knowledge Bases:</strong> <span id="importPreviewKBs"></span></p>
                    </div>
                </div>

                <div id="importError" class="hidden mb-4 bg-red-50 border border-red-200 rounded-lg p-3">
                    <p class="text-sm text-red-800" id="importErrorMessage"></p>
                </div>

                <div class="flex gap-2">
                    <button onclick="previewSharedAgent()" class="flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                        üëÅÔ∏è Preview
                    </button>
                    <button onclick="triggerImportFile()" class="flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                        üìÅ Import File
                    </button>
                </div>
                <input type="file" id="importSharedFile" class="hidden" accept=".json" onchange="handleImportFile(event)">
            </div>
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button onclick="closeImportSharedAgentModal()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                    Cancel
                </button>
                <button onclick="confirmImportSharedAgent()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium">
                    üì• Import Agent
                </button>
            </div>
        </div>
    </div>

    <!-- Community Gallery Modal -->
    <div id="communityGalleryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                    <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                    </svg>
                    Community Agent Gallery
                    <span id="communityAgentCount" class="bg-emerald-100 text-emerald-700 text-xs px-2 py-0.5 rounded-full">0</span>
                </h3>
                <button onclick="closeCommunityGalleryModal()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
            </div>

            <div class="p-4 border-b border-gray-100 bg-gray-50">
                <div class="flex flex-col md:flex-row gap-3">
                    <div class="flex-1">
                        <input type="text" id="searchCommunityAgents" placeholder="Search community agents..." class="w-full border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
                    </div>
                    <div class="flex gap-2">
                        <select id="filterCommunityCategory" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
                            <option value="">All Categories</option>
                            <option value="marketing">Marketing</option>
                            <option value="hr">HR</option>
                            <option value="support">Support</option>
                            <option value="sales">Sales</option>
                            <option value="analytics">Analytics</option>
                            <option value="other">Other</option>
                        </select>
                        <select id="sortCommunityAgents" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
                            <option value="newest">Newest First</option>
                            <option value="popular">Most Popular</option>
                            <option value="name">Name A-Z</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-6">
                <div id="communityAgentsLoading" class="text-center py-12">
                    <div class="inline-flex items-center gap-3">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"></div>
                        <span class="text-gray-600">Loading community agents...</span>
                    </div>
                </div>

                <div id="communityAgentsList" class="grid grid-cols-1 md:grid-cols-2 gap-4 hidden">
                    <!-- Community agents will be dynamically loaded here -->
                </div>

                <div id="communityAgentsEmpty" class="text-center py-12 text-gray-400 hidden">
                    <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                    </svg>
                    <p class="text-lg font-medium">No agents found</p>
                    <p class="text-sm mt-1">Try a different search or be the first to share!</p>
                </div>

                <div id="communityAgentsError" class="text-center py-12 text-red-500 hidden">
                    <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                    <p class="text-lg font-medium">Failed to load community agents</p>
                    <p class="text-sm mt-1" id="communityErrorMessage"></p>
                    <button onclick="loadCommunityAgents()" class="mt-4 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors">
                        Try Again
                    </button>
                </div>
            </div>

            <div class="flex justify-between items-center p-6 border-t border-gray-200 bg-gray-50">
                <div class="flex items-center gap-2">
                    <button onclick="openPublishAgentModal()" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white rounded-lg transition-colors flex items-center gap-2 shadow-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                        </svg>
                        Publish Your Agent
                    </button>
                    <button id="adminToggleBtn" onclick="toggleCommunityAdmin()" class="px-3 py-2 text-xs bg-gray-200 hover:bg-gray-300 text-gray-600 rounded-lg transition-colors" title="Admin Login">
                        üîê Admin
                    </button>
                </div>
                <button onclick="closeCommunityGalleryModal()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Publish Agent to Community Modal -->
    <div id="publishAgentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                    </svg>
                    Publish to Community
                </h3>
                <button onclick="closePublishAgentModal()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
            </div>
            <div class="p-6">
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                    <p class="text-sm text-purple-900">
                        <strong>Share with the community!</strong> Published agents will be available for all users to browse and import.
                    </p>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Agent to Publish <span class="text-red-500">*</span></label>
                        <select id="publishAgentSelect" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">-- Select a saved agent --</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Or publish your current agent configuration</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Author Name <span class="text-red-500">*</span></label>
                        <input type="text" id="publishAuthorName" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Your name or company">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Category <span class="text-red-500">*</span></label>
                        <select id="publishCategory" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="marketing">Marketing</option>
                            <option value="hr">HR</option>
                            <option value="support">Support</option>
                            <option value="sales">Sales</option>
                            <option value="analytics">Analytics</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tags (optional)</label>
                        <input type="text" id="publishTags" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="campaign, ads, optimization">
                        <p class="text-xs text-gray-500 mt-1">Comma-separated tags to help others find your agent</p>
                    </div>
                </div>

                <div id="publishStatus" class="mt-4 hidden">
                    <div id="publishLoading" class="flex items-center gap-2 text-purple-600">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-purple-600"></div>
                        <span class="text-sm">Publishing to community...</span>
                    </div>
                    <div id="publishSuccess" class="hidden bg-green-50 border border-green-200 rounded-lg p-3">
                        <p class="text-sm text-green-800">
                            <strong>Published successfully!</strong> Your agent is now available in the community gallery.
                        </p>
                    </div>
                    <div id="publishError" class="hidden bg-red-50 border border-red-200 rounded-lg p-3">
                        <p class="text-sm text-red-800" id="publishErrorMessage"></p>
                    </div>
                </div>
            </div>
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button onclick="closePublishAgentModal()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                    Cancel
                </button>
                <button onclick="publishAgentToCommunity()" id="publishConfirmBtn" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white rounded-lg transition-colors font-medium">
                    üöÄ Publish Agent
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="config-helper.js"></script>
    <script src="td-llm-api.js"></script>
    <script src="agent-templates.js"></script>
    <script src="wizard-ai.js?v=20251205-tdllm"></script>
</body>
</html>
